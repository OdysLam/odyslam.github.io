<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Let's get into (Monty) Python &#8211; Project L</title>
<meta name="description" content="script.py : an introduction">
<meta name="keywords" content="webiopi, python, guide">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://odyslam.github.io/images/">
<meta name="twitter:title" content="Let's get into (Monty) Python">
<meta name="twitter:description" content="script.py : an introduction">
<meta name="twitter:creator" content="@CynicOdys">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Let's get into (Monty) Python">
<meta property="og:description" content="script.py : an introduction">
<meta property="og:url" content="http://odyslam.github.io/python-post/">
<meta property="og:site_name" content="Project L">





<link rel="canonical" href="http://odyslam.github.io/python-post/">
<link href="http://odyslam.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Project L Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://odyslam.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://odyslam.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<!-- 32x32 -->
<link rel="shortcut icon" href="http://odyslam.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<!--<link rel="apple-touch-icon-precomposed" href="http://odyslam.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini 
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://odyslam.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch 
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://odyslam.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation 
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://odyslam.github.io/images/apple-touch-icon-144x144-precomposed.png">-->




<style type="text/css">body {background-image:url(http://odyslam.github.io/images/home3.jpg);}</style>


</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://odyslam.github.io/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://odyslam.github.io/images/avatar.png" alt="Odysseas Lamtzidis photo" class="author-photo">
					<h4>Odysseas Lamtzidis</h4>
					<p>Ece student currently studying in Patras. Interested in IoT and electronics.
In love with marketing and entrepreneurship</p>
				</li>
				<li><a href="http://odyslam.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:odyslam@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/CynicOdys"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/odysseas007"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				<li>
					<a href="https://linkedin.com/in/lamtzidisodysseas"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				
				
				<li>
					<a href="https://instagram.com/odys_lam"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://odyslam.github.io/posts/">All Posts</a></li>
				<li><a href="http://odyslam.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	    
	    <li><a href="http://odyslam.github.io/introduction/" >Introduction</a></li>
	  
	    
	    <li><a href="http://odyslam.github.io/raspberry/" >Raspberry IoT</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title" ><a href="http://odyslam.github.io/python-post/" rel="bookmark" title="Let's get into (Monty) Python">Let's get into (Monty) Python</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2016-04-03T00:00:00+03:00">April 03, 2016</time></span></h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <h2 id="the-script">The script:</h2>

<p>As I mentioned before, we are going to start with examining the python code, later we will move to javascript and html.</p>

<p class="notice">You can find the full code uploaded to github <em><a href="https://github.com/OdysLam/GLaDOS-project/blob/master/script.py">here</a></em></p>

<p>But let’s take things from the start:</p>

<p>Firstly, I do my imports:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">webiopi</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">wakeonlan</span> <span class="kn">import</span> <span class="n">wol</span> 
<span class="kn">import</span> <span class="nn">pi_switch</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">vncdotool</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span></code></pre></figure>

<p>As you can see I import a number of libraries, I am going to get into detail in later posts so as to keep this post nice and clean. I will explain where each and every library that is neaded.</p>

<p>The next important part is where I define the  pins I am going to use. This way, I can easily change the pins by just changing the variable.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">SERVO</span>  <span class="o">=</span> <span class="mi">18</span>
<span class="n">OutDoor</span> <span class="o">=</span> <span class="mi">25</span></code></pre></figure>

<p>Here is the GPIO pinout again, you can see the corresponding number of each pin as well.</p>

<p><img src="http://www.toptechboy.com/wp-content/uploads/2015/06/raspberry-pi-2-pinout.jpg" alt="GPIO PINOUT" /></p>

<p>As I said before, we have 3 basic functions that are defined by webiopi: <em>loop</em>-<em>setup</em>-<em>destroy</em>. <code class="highlighter-rouge">Loop</code> is self explanatory, <code class="highlighter-rouge">setup</code> is run once when the webiopi service starts and <code class="highlighter-rouge">detroy</code> when we shut it down.</p>

<h4 id="setup">Setup:</h4>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
    <span class="n">webiopi</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Script with macros - Setup"</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">Servo</span>
    <span class="n">Servo</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">setFunction</span><span class="p">(</span><span class="n">OutDoor</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">setFunction</span><span class="p">(</span><span class="n">SERVO</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">PWM</span><span class="p">)</span>
    <span class="n">CloseUDoor</span><span class="p">()</span>   <span class="c"># set to 0 (neutral)</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">OutDoor</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">Heater</span>
    <span class="k">global</span> <span class="n">hostname</span>
    <span class="k">global</span> <span class="n">sender</span>
    <span class="n">Heater</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="s">"192.168.1.20"</span> <span class="c">#example</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="n">pi_switch</span><span class="o">.</span><span class="n">RCSwitchSender</span><span class="p">()</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">enableTransmit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> </code></pre></figure>

<p>First good programming advice is to <em>always</em> include debuging output functions so as you can monitor the program when you run it in debuging mode.</p>

<p>Now, as far as webiopi is concerned, the <code class="highlighter-rouge">GPIO.setFunction(pin_number,type)</code> it’s the first step, as it informs webiopi on what <em>kind</em> of pin each pin is . For example, here I have set  we <code class="highlighter-rouge">OutDoor</code> pin to be a <code class="highlighter-rouge">GPIO.OUT</code>, in other words, a simple digital output (either 0v or 3.3v).</p>

<p>The servo pin must be set as pwm(pulse width modulation), for which you can read more about <a href="http://www.jameco.com/jameco/workshop/howitworks/how-servo-motors-work.html">here</a>.
Webiopi has it’s own library to deal with servos, meaning that the needed pulse will be generated by the library and we don’t need to code it(you can code it by just setting a loop for the pin to turn on/off rappidly).We are just going to call the appropriate webiopi function and set the needed angle.</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">CloseUdoor</code> is the function responsible for locking the door.(more later)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">GPIO.digitalWrite(a,b)</code> produces an output at the “a” pin,the output can be either logic HIGH or LOW (3,3v or 0v)</p>
  </li>
</ul>

<p>Next we have some library-specific functions that as I have said will be covered later when we speak about the various libraries.</p>

<h2 id="some-custom-functions">Some custom functions:</h2>

<p>The first function that we are going to cover is an easy one:</p>

<h3 id="lockingunlocking-buildings-door">Locking/Unlocking building’s door:</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">DownDoor</span><span class="p">():</span>
    <span class="n">webiopi</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"OpenDdoor"</span><span class="p">)</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">OutDoor</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">Timer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">CloseDDoor</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></figure>

<p>It’s job is to to unlock my building’s door. By setting the pin either HIGH or LOW I enable or not current through a simple relay. The door would normaly unlock as long as I press a button, instead of that, I have connected the appropriate wires to a relay that will play the button’s role.</p>

<p>In order to turn it off again (and stop unlocking the door) I use the <code class="highlighter-rouge">threading.Timer(seconds,function)</code> function that is defined along with it’s library <code class="highlighter-rouge">threading</code> <a href="https://docs.python.org/2/library/threading.html#timer-objects">here</a>.</p>

<p>The wonderful thing about this timer it’s that not only it does not freeze our program while waiting for it to execute (like webiopi.sleep), but we can also stop the Timer with the appropriate function. This way we can make sure that accidently executing a command won’t end in overlapping Timers that will both run the function.</p>

<p class="notice">Although I have not used them in the current version, it’s an addition that has to be made.</p>

<h3 id="lockingunlocking-appartments-door">Locking/Unlocking appartment’s door:</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">UpDoor</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="n">webiopi</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"OpenUdoor="</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">Servo</span>
    <span class="n">webiopi</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">Servo</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Servo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">notify_status</span> <span class="o">=</span> <span class="s">"Door Unlocked"</span>
        <span class="n">alert</span><span class="p">(</span><span class="n">notify_status</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">):</span>
            <span class="n">webiopi</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span>
            <span class="c">#webiopi.sleep(0.01)</span>
            <span class="n">GPIO</span><span class="o">.</span><span class="n">pwmWriteAngle</span><span class="p">(</span><span class="n">SERVO</span><span class="p">,</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">Servo</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s">"enter"</span><span class="p">:</span>
            <span class="n">Timer</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="n">CloseUDoor</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s">"leave"</span><span class="p">:</span>
            <span class="n">Timer</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">CloseUDoor</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s">"knock"</span><span class="p">:</span>
            <span class="n">Timer</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="n">CloseUDoor</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></figure>

<p>Ok, don’t panic, it’s actually fairly straight forward.</p>

<p>Firstly, I use a global variable named Servo so as to track whether my door is locked or unlocked. This way I can prevent the servo from trying turn the gears while it’s arleady locked and thus potentially damage it.</p>

<p>Then, I check wether it’s locked <code class="highlighter-rouge">Servo==0</code> and if it is, I send an alert to my weaved app on my iphone.(more later)</p>

<h3 id="stop-right-there-you-criminal-scum">Stop right there you criminal scum!</h3>

<p>Before we go any further we need to understand some basic principles about servo because they tend to have an <em>arcane</em> behaviour.</p>

<p>As you have read already,the servo position is defined by the length of the pulse or in other words it’s duty cycle. Every servo has it’s own default settings. For example,mine works in the range of <em>500μs το 2500μs</em>, meaning that 1500μs is the <code class="highlighter-rouge">0</code> degrees. Moreover, for every 45 degrees, either + or -, the duty cycle is + or - 500μs.</p>

<p>Webiopi’s servo library uses the futaba standard, meaning that 0 is defined as 1520μs with a 400μs per 45 degrees.</p>

<p>Thus, in my code, my servo will go <code class="highlighter-rouge">from -90 to +90 degrees</code>. This is very important, because depending on the servo you may need to adjust the code to <code class="highlighter-rouge">from 0 to 180 degrees</code> if for example your servo works in the area of (1500μs-3500μs).</p>

<h3 id="so">So..</h3>
<p>I want the servo to turn as smoothly as possible, to accomplish that, I use a loop to set the angle to a range of (-90,+90). I could just set it straight to +90, but it wouldn’t be that smooth and may cause problems with the lock.</p>

<p>Lastly, depending on the button I press on my interface, I run the function with a different argument which determines how much time it will take to run the function that locks the door again.(for example, if I am leaving, I just need a 10 sec window to open the door, exit my appartment and then close it so it locks again)</p>

<p>Cool, by now you should have started getting comfortable with the python code, in the next posts we will be covering more libraries and functions.</p>

<h3 id="important">Important!</h3>
<p>Remember that if you want to follow this project from the first post, go to the posts tab and click All Posts.</p>

<p>Stay tuned!</p>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://odyslam.github.io/tags/#webiopi" title="Pages tagged webiopi" class="tag"><span class="term">webiopi</span></a><a href="http://odyslam.github.io/tags/#python" title="Pages tagged python" class="tag"><span class="term">python</span></a><a href="http://odyslam.github.io/tags/#guide" title="Pages tagged guide" class="tag"><span class="term">guide</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2016-04-25">April 25, 2016</time></span></span>
        <span class="author vcard"><span class="fn">Odysseas Lamtzidis</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://odyslam.github.io/python-post/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://odyslam.github.io/python-post/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://odyslam.github.io/python-post/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://odyslam.github.io/webiopi-post/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://odyslam.github.io/webiopi-post/" title="In webiopi we trust">In webiopi we trust</a></h3>
      <p>GLaDOS main library <a href="http://odyslam.github.io/webiopi-post/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://odyslam.github.io/languages-post/" title="Are you talking to me?">Are you talking to me?</a></h4>
        <span>Published on March 25, 2016</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://odyslam.github.io/GlaDOS-post/" title="GlaDOS">GlaDOS</a></h4>
        <span>Published on March 24, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Odysseas Lamtzidis. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the HPSTR Theme and cared by GLaDOS</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://odyslam.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://odyslam.github.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75553304-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'projectl'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
